# OJ-frontend
OJ-frontend
##这是buaa online Judge 第四代的前端业务
当初本来打算用angualr

但是发现angualr太重,同志们基本学不来，而且本身的体积也很醉人，所以没有使用。

但是很喜欢写单页的web应用，因为只要处理得当，能够极大地提高用户的体验，减少服务器端的渲染压力（**我们上一个版本的OJ的性能瓶颈之一就是django页面渲染比较渣。。。**）

改用了一套自己撸的路由插件，松散地耦合了几个部分。

说一下基本实现的功能。

0.通过一个routerController来管理路由的行为，主要是页面跳转和页面之间的交互。详情可以看[这里](https://github.com/WunGCQ/OJ-frontend/blob/master/public/javascripts/Controllers/RouteController.js)
处理各个页面跳转之间的逻辑，主要是对页面元素的操作啊，逻辑等等

1.核心是jRouter这个插件，做的事情比较简单，就是在这个的原型里注册router函数等行为，作为一个控制路由的中枢，它可以扫描文档中的a标签，根据a标签的路径为它自动绑定事先已经写好的参数，当然咯，会有更多的扩展行要考虑，现在主要是做功能。

2.利用了HTML5 history API,这个大家都熟悉，就不提了。

3.同时呢，OJ很有可能会扔一个链接给别人看，所以必须支持页面的自解析，其实也不难，因为jRouter插件本身就是接收url参数的，所以只需要再onload里面添加就好，将自解析的行为封装到initPage中来。

4.一般分享的页面会是带有参数的，所以这个jRouter会轻度地支持解析参数，不过，这基于一个约定就是参数总是放在后面的，这样通过根域名后面的第一个词就给你找到你在routerController里面的控制器。

5.到这里你肯定知道a标签是不再管什么用了。。是的。。a标签都被绑上了事件。。什么事件呢？这些就是在a标签上的几个data属性记录了对应的控制器在jRouter的prototype的controller数组中的位置了~

6.再就是用了juicer模板引擎，真的很好用~~~

7.在github上面做过测试，我搭建的jekyll静态页面里面有这个网页[现在的模样](http://wungcq.github.io/public/templates/index.html)
加载的速度还是很可观的，这还是没有压缩和uglify的情况~~

8.当然既然连路由都包办了所以数据模型很重要，我基本把与服务器数据和模板打交道的活都扔给了Model.js这么个东西,其原型包含了对这个数据模型的CRUD的API路径、模板路径、模板处理等等等等~

9.然后剩下的就都交给普普通通的view的Controller啦~负责用户交互和少量不适合通过model与服务器交互的ajax任务，这样~

A.这一整套UI也是我自己撸出来的啊。。。调点CSS费了老劲，没有设计师只能再大脑中切图出图=_=。。

B.对了，还写了一个小插件，负责在页面顶端推送消息~

C.先写这么些，明天好好写写在撸这么一套体系中遇到的一些问题和对策，前提当然是我先把用户子系统和小组的子系统给写完，不过照葫芦画瓢~就是画页面不太好玩啊~

2015 2 27
